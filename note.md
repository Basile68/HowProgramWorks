# CPU

## 热身问答

1. 程序是指示计算机每一步行动的一组指令；
2. 程序是由指令和数据构成的；
3. 机器语言是 CPU 可以直接识别并使用的语言；
     - 使用 C、Java 等语言编写的程序最后都会转化成机器语言。
4. 正在运行的程序存储在内存；
     - 硬盘和磁盘等媒介上保存的程序被复制到内存后才能运行。
5. 内存地址是内存中用来表示命令和数据存储位置的数值；
     - 地址是由整数值表示。
        - 计算机的内存（RAM）是由许多存储单元组成的，每个存储单元都有一个唯一的编号，这个编号就叫 内存地址。
6. 计算机的构成元件中， 负责程序的解释和运行的是CPU。

## CPU 的内部结构解析

CPU 和内存是由许多晶体管组成的电子部件， 通常称为 IC (lntegrated Circuit, 集成电路）构成的。  

从功能方面来看，CPU的内部由四个部分构成， 各部分之间由电流信号相互连通。
1. 寄存器；
   - 寄存器可用来暂存指令、数据等处理对象， 可以将其看作是内存的一种。
2. 控制器；
   - 控制器负责把内存上的指令、数据等读入寄存器，并根据指令的执行结果来控制整个计算机。
3. 运算器；
   - 运算器负责运算从内存读入寄存器的数据。
4. 时钟。
   - 时钟负责发出 CPU 开始计时的时钟信号。
   
> 有些计算机的时钟位于CPU的外部
   - 说明计算机系统中的“时钟信号”（Clock Signal）不是由CPU内部产生的，而是由主板或其他外部电路提供给CPU的。

> 程序运行流程示例：
  1. 程序员用C语言等高级语言编写程序；
  2. 将程序编译后转换成机器语言的 EXE 文件；
  3. 程序运行时，在内存中生成 EXE 文件的副本；
     - 因为 CPU 只能直接从内存（RAM）中读取和执行指令，而不能直接从硬盘上运行程序。
  4. CPU 解释并执行程序内容。

> 通常所说的内存指的是计算机的主存储器（main memory），简称主存。
  主存通过控制芯片等与 CPU 相连，主要负责存储指令和数据。
  需要注意的是，主存中存储的指令和数据会随着计算机的关机而自动清除。
  
## CPU 是寄存器的集合体

CPU 的构成部分中，程序员只需要了解寄存器即可，因为程序是把寄存器作为对象来描述的，其余部分都不用太过关注。  

> 通常我们将汇编语言编写的程序转化成机器语言的过程称为汇编；反之，机器语言程序转化成汇编语言程序的过程则称为反汇编。

通过阅读汇编语言编写的代码，能够了解转化成机器语言的程序的运行情况。机器语言级别的程序时通过寄存器来处理（即存储）的。
  - 也就是说，在程序员看来，“CPU 是寄存器的集合体”。

对于程序员来说，CPU 时具有各种功能的寄存器的集合体。
  - 其中，程序计数器、累加寄存器、标志寄存器、指令寄存器和栈寄存器都只有一个，其他的寄存器一般由多个。
  - 程序计数器和标志寄存器比较特殊。
  
|种类|功能|
|---|---|
|累加寄存器（accumulator register）|存储执行运算的数据和运算后的数据|
|标志寄存器（flag register）|存储运算处理后的 CPU 状态|
|程序计数器（program counter）|存储下一条指令所在内存的地址|
|基址寄存器（base register）|存储数据内存的起始地址|
|变址寄存器（index register）|存储基址寄存器的相对地址|
|通用寄存器（general purpose register）|存储任意数据|
|指令寄存器（instruction register）|存储指令。CPU 内部使用，程序员无法通过程序对该寄存器进行读写操作|
|栈寄存器（stack register）|存储栈区域的起始地址|

## CPU 解释并执行程序的过程（个人理解

1. 由操作系统在加载程序时，根据“入口点”设置程序计数器里的指令地址；
2. 控制器根据 PC 提供的地址，向内存发起读取指令；
3. 内存获取读取指令后向控制器返回对应地址中存储的指令内容；
4. 控制器进行译码分析指令类型并执行，即指挥 ALU/寄存器/内存完成操作；
5. 更新 PC 中的值；
6. 回到第二步，继续下一条指令。

## 条件分支和循环机制

程序的流程分为顺序执行、条件分支和循环三种。
  - 顺序执行是指按照地址内容的顺序执行指令；
    - 顺序执行中，每执行一个指令程序计数器的值就会自动递增以指向内存中下一条连续的指令。
  - 条件分支是指根据条件执行任意地址的指令；
  - 循环是指重复执行同一地址的指令。
  


























































































