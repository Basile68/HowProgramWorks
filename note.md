# CPU

## 热身问答

1. 程序是指示计算机每一步行动的一组指令；
2. 程序是由指令和数据构成的；
3. 机器语言是 CPU 可以直接识别并使用的语言；
     - 使用 C、Java 等语言编写的程序最后都会转化成机器语言。
4. 正在运行的程序存储在内存；
     - 硬盘和磁盘等媒介上保存的程序被复制到内存后才能运行。
5. 内存地址是内存中用来表示命令和数据存储位置的数值；
     - 地址是由整数值表示。
        - 计算机的内存（RAM）是由许多存储单元组成的，每个存储单元都有一个唯一的编号，这个编号就叫 内存地址。
6. 计算机的构成元件中， 负责程序的解释和运行的是CPU。

## CPU 的内部结构解析

CPU 和内存是由许多晶体管组成的电子部件， 通常称为 IC (lntegrated Circuit, 集成电路）构成的。  

从功能方面来看，CPU的内部由四个部分构成， 各部分之间由电流信号相互连通。
1. 寄存器；
   - 寄存器可用来暂存指令、数据等处理对象， 可以将其看作是内存的一种。
2. 控制器；
   - 控制器负责把内存上的指令、数据等读入寄存器，并根据指令的执行结果来控制整个计算机。
3. 运算器；
   - 运算器负责运算从内存读入寄存器的数据。
4. 时钟。
   - 时钟负责发出 CPU 开始计时的时钟信号。
   
> 有些计算机的时钟位于CPU的外部
   - 说明计算机系统中的“时钟信号”（Clock Signal）不是由CPU内部产生的，而是由主板或其他外部电路提供给CPU的。

> 程序运行流程示例：
  1. 程序员用C语言等高级语言编写程序；
  2. 将程序编译后转换成机器语言的 EXE 文件；
  3. 程序运行时，在内存中生成 EXE 文件的副本；
     - 因为 CPU 只能直接从内存（RAM）中读取和执行指令，而不能直接从硬盘上运行程序。
  4. CPU 解释并执行程序内容。

> 通常所说的内存指的是计算机的主存储器（main memory），简称主存。
  主存通过控制芯片等与 CPU 相连，主要负责存储指令和数据。
  需要注意的是，主存中存储的指令和数据会随着计算机的关机而自动清除。
  
## CPU 是寄存器的集合体

CPU 的构成部分中，程序员只需要了解寄存器即可，因为程序是把寄存器作为对象来描述的，其余部分都不用太过关注。  

> 通常我们将汇编语言编写的程序转化成机器语言的过程称为汇编；反之，机器语言程序转化成汇编语言程序的过程则称为反汇编。

通过阅读汇编语言编写的代码，能够了解转化成机器语言的程序的运行情况。机器语言级别的程序时通过寄存器来处理（即存储）的。
  - 也就是说，在程序员看来，“CPU 是寄存器的集合体”。

对于程序员来说，CPU 时具有各种功能的寄存器的集合体。
  - 其中，程序计数器、累加寄存器、标志寄存器、指令寄存器和栈寄存器都只有一个，其他的寄存器一般由多个。
  - 程序计数器和标志寄存器比较特殊。
  
|种类|功能|
|---|---|
|累加寄存器（accumulator register）|存储执行运算的数据和运算后的数据|
|标志寄存器（flag register）|存储运算处理后的 CPU 状态|
|程序计数器（program counter）|存储下一条指令所在内存的地址|
|基址寄存器（base register）|存储数据内存的起始地址|
|变址寄存器（index register）|存储基址寄存器的相对地址|
|通用寄存器（general purpose register）|存储任意数据|
|指令寄存器（instruction register）|存储指令。CPU 内部使用，程序员无法通过程序对该寄存器进行读写操作|
|栈寄存器（stack register）|存储栈区域的起始地址|

## CPU 解释并执行程序的过程（个人理解

1. 由操作系统在加载程序时，根据“入口点”设置程序计数器里的指令地址；
2. 控制器根据 PC 提供的地址，向内存发起读取指令；
3. 内存获取读取指令后向控制器返回对应地址中存储的指令内容；
4. 控制器进行译码分析指令类型并执行，即指挥 ALU/寄存器/内存完成操作；
5. 更新 PC 中的值；
6. 回到第二步，继续下一条指令。

## 条件分支和循环机制

程序的流程分为顺序执行、条件分支和循环三种。
  - 顺序执行是指按照地址内容的顺序执行指令；
    - 顺序执行中，每执行一个指令程序计数器的值就会自动递增以指向内存中下一条连续的指令。
  - 条件分支是指根据条件执行任意地址的指令；
  - 循环是指重复执行同一地址的指令。

> 条件分支和循环中使用的跳转指令，会参照当前执行的运算结果来判断是否跳转。
  - 标志寄存器的数值会根据运算结果自动设定，条件分支在跳转指令前会进行比较运算；
    - 至于是否执行跳转指令，则由 CPU 在参考标志寄存器的数值后进行判断。
      
## 函数的调用机制

1. 函数调用时使用call指令，而不是跳转指令；
2. call指令会把调用函数后要执行的指令地址存储在程序的栈区域内；
3. 然后将函数的入口地址设定到程序计数器；
4. 函数处理完毕后，再通过函数的出口来执行return指令；
    - return 指令的功能是把保存在栈中的地址设定到程序计数器中。

## 通过地址和索引实现数组

通过基址寄存器和变址寄存器可以对主内存上特定的内存区域进行划分，从而实现类似于数组的操作。

例如查看10000000地址~1000FFFF地址时，
   - 可以将10000000存入基址寄存器，并使变址寄存器的值在00000000~0000FFFF变化；
   - CPU 则会把基址寄存器+变址寄存器的值解释为实际查看的内存地址。

> 变址寄存器的值就相当于高级编程语言程序中数组的索引功能。

> 机器语言指令的主要类型和功能

|类型|功能|
|---|---|
|数据转送指令|寄存器和内存、内存和内存、寄存器和外围设备之间的数据读取操作|
|运算指令|用累加寄存器执行算术运算、逻辑运算、比较运算和移位运算|
|跳转指令|实现条件分支、循环、强制跳转等|
|call/return指令|函数的调用/返回调用前的地址|

# 数据是用二进制数表示的

## 热身问答

8位=1字节，32位就是4字节；
  - “位”是数据最小单位（0 或 1），“字节”是计算机处理数据的基本单位，1 字节 = 8 个位。
反转部分图形模式时， 使用的是什么逻辑运算？
  - XOR 运算只反转与1相对应的位。NOT运算时反转所有的位。

## 用二进制数表示计算机信息的原因

计算机内部是由 IC 这种电子部件构成的，IC 上的所有引脚都只有直流电压 0V 或 5V 两个状态。也就是说 IC 的一个引脚，只能表示两个状态。  
IC 的这个特性，决定了计算机的信息数据只能用二进制数来处理。  

> 二进制数的位数一般是8位、16位、32位......也就是8的倍数，这是因为计算机所处理的信息的基本单位是8位二进制数。  

内存和磁盘都使用字节单位来存储和读写数据，使用位单位则无法读写数据，因此字节是信息的基本单位。  
  - 用字节单位处理数据时，如果数字小于存储数据的字节数（=二进制数的位数），那么高位上就用0填补。
    - 例如，100111这个6位二进制数，用8位（=1字节）表示时为00100111，用16位（=2字节）表示时为0000000000100111.

对于用二进制数表示的信息，计算机不会区分它是数值、文字，还是某种图片的模式等，而是根据编写程序的各位对计算机发出的指示来进行信息的处理（运算）。
  - 例如00100111这样的二进制数，既可以视为纯粹的数值作加法运算，也可以视为”“文字而显示在显示器上；
    - 具体进行何种处理，取决于程序的编写方式。
    
## 位权

位权（Positional Weight），指的是在一个数中，某一位上的数字所代表的实际值，它由该位的位置决定。   

位权 = 基数 ^ 位数位置（从右往左，从0开始）
  - 基数：进制的“底”，比如十进制基数是10，二进制是2。
  - 位置：从右往左数，最右边第一位是第0位。

> 比如，十进制中的534，534 = 5×10² + 3×10¹ + 4×10⁰ = 500 + 30 + 4，这里的 10², 10¹, 10⁰ 就是各位的位权。

位权的思考方式也同样适用于二进制数。即第1位是2的0次幂，第2位是2的1次幂，第3位是2的2次幂，......。

> 二进制中为什么要使用各数位的数值和位权相乘后”相加“这个处理
  - 因为在任何进制下的数字，本质上都是一个多项式展开式，十进制是这样的，这种思考方式在二进制数中也是通用的；
  - 这不是巧合，而是人类为了高效表示数字而人为规定的规则。

## 移位运算和乘除运算的关系

和十进制数一样，四则运算同样也可以使用在二进制数中，只要注意逢2进位即可。

二进制数所特有的运算，也是计算机所特有的运算，因此可以说是了解程序运行原理的关键。
1. 移位运算；
2. 乘除运算。

### 移位运算

移位运算指的是将二进制数值的各数位进行左右移位（shift = 移位）的运算。  

移位有左移（向高位方向）和右移（向低位方向）两种。  

在一次运算中，可以进行多个数位的移位操作。  

在 C 语言中，<<这个运算符表示左移，>>表示右移，运算符左侧是被移位的值，右侧表示要移位的位数；
  - 移位运送中左移后空出的低位用0填充，
  - 而用来填充右移后空出来的高位的数值，有0和1两种形式。

> 在二进制中，位权是从右往左、从 0 开始计算的！
  从右往左，依次是0、1、2、3、4、......

#### 二进制表示负数的方法和右移的方法

二进制数中表示负数值时，一般会把最高位作为符号来使用，因此我们把这个最高位称为符号位。
  - 符号位是0时表示正数，符号位是1时表示负数。

计算机在做减法运算时，实际上内部是在做加法运算。  
  - A - B 在计算机中会被转换成 A + (-B)，而 -B 是通过求 B 的补码得到的。

为此在表示负数时就需要使用 “二进制的补数”，补数就是用正数来表示负数。  
获得补数的方法是，将二进制数的各数位的数值全部取反，然后再将结果加1。  
  -这里的加1是加在最低位上的。

>  00000001  
  +10000001
  ——————————
   10000010
   
   二进制的加法是当两个1相加时，结果是0并产生一个进位1
  



---

二进制左移后就会变成原来的2倍、4倍、8倍......反之，二进制数右移后则会变成原来的1/2、1/4、1/8......  
因此移位运算可以代替乘法运算和除法运算。





























































